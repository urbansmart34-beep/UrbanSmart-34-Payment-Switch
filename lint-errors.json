[{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1033,1036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1033,1036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport async function getDashboardStats() {\r\n    const totalSalesAggregate = await prisma.transaction.aggregate({\r\n        _sum: {\r\n            amount: true,\r\n        },\r\n        where: {\r\n            status: \"SUCCESS\",\r\n        },\r\n    });\r\n\r\n    const transactionCount = await prisma.transaction.count();\r\n\r\n    const activeStores = await prisma.store.count();\r\n\r\n    const failedTransactions = await prisma.transaction.count({\r\n        where: { status: \"FAILED\" }\r\n    });\r\n\r\n    const refundRate = transactionCount > 0 ? (failedTransactions / transactionCount) * 100 : 0;\r\n\r\n    const recentTransactions = await prisma.transaction.findMany({\r\n        take: 5,\r\n        orderBy: { createdAt: \"desc\" },\r\n        include: {\r\n            store: true,\r\n        }\r\n    });\r\n\r\n    return {\r\n        totalSales: totalSalesAggregate._sum.amount || 0,\r\n        transactionCount,\r\n        activeStores,\r\n        refundRate,\r\n        recentTransactions: recentTransactions.map((tx: any) => ({\r\n            id: tx.id,\r\n            store: tx.store?.name || \"Unknown Store\",\r\n            time: tx.createdAt.toISOString(),\r\n            amount: tx.amount,\r\n            status: tx.status,\r\n            icon: \"store\"\r\n        }))\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\actions\\refund.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[825,828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[825,828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nexport async function refundTransaction(transactionId: string) {\r\n    try {\r\n        const transaction = await prisma.transaction.findUnique({\r\n            where: { id: transactionId },\r\n        });\r\n\r\n        if (!transaction) throw new Error(\"Transaction not found\");\r\n\r\n        if (transaction.status !== \"SUCCESS\") {\r\n            throw new Error(\"Only successful transactions can be refunded\");\r\n        }\r\n\r\n        // TODO: Call Yoco Refund API\r\n        // For now, simulate refund\r\n\r\n        await prisma.transaction.update({\r\n            where: { id: transactionId },\r\n            data: { status: \"REFUNDED\" },\r\n        });\r\n\r\n        revalidatePath(\"/\");\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\analytics\\page.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\analytics\\page.tsx:171:140\n  169 |                                 ? DAY_LABELS.map((d) => (\n  170 |                                     <div key={d} className=\"flex-1 flex flex-col justify-end gap-1 h-full\">\n> 171 |                                         <div className=\"w-full bg-slate-200 dark:bg-slate-700 rounded-t animate-pulse\" style={{ height: `${Math.random() * 60 + 20}%` }} />\n      |                                                                                                                                            ^^^^^^^^^^^^^ Cannot call impure function\n  172 |                                         <div className=\"w-full bg-slate-100 dark:bg-slate-600 rounded-t animate-pulse\" style={{ height: `${Math.random() * 40 + 10}%` }} />\n  173 |                                     </div>\n  174 |                                 ))","line":171,"column":140,"nodeType":null,"endLine":171,"endColumn":153},{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\analytics\\page.tsx:172:140\n  170 |                                     <div key={d} className=\"flex-1 flex flex-col justify-end gap-1 h-full\">\n  171 |                                         <div className=\"w-full bg-slate-200 dark:bg-slate-700 rounded-t animate-pulse\" style={{ height: `${Math.random() * 60 + 20}%` }} />\n> 172 |                                         <div className=\"w-full bg-slate-100 dark:bg-slate-600 rounded-t animate-pulse\" style={{ height: `${Math.random() * 40 + 10}%` }} />\n      |                                                                                                                                            ^^^^^^^^^^^^^ Cannot call impure function\n  173 |                                     </div>\n  174 |                                 ))\n  175 |                                 : (data?.weeklyBars ?? []).map((bar, i) => {","line":172,"column":140,"nodeType":null,"endLine":172,"endColumn":153}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Link from \"next/link\";\r\n\r\ntype DateRange = \"Week\" | \"Month\" | \"Quarter\" | \"Year\";\r\n\r\ninterface AnalyticsData {\r\n    totalVolume: number;\r\n    successRate: number;\r\n    avgTicket: number;\r\n    successCount: number;\r\n    failedCount: number;\r\n    pendingCount: number;\r\n    topStores: { id: string; name: string; volume: number; count: number; trend: number }[];\r\n    weeklyBars: { day: string; storeA: number; storeB: number }[];\r\n}\r\n\r\nconst DAY_LABELS = [\"MON\", \"TUE\", \"WED\", \"THU\", \"FRI\", \"SAT\", \"SUN\"];\r\n\r\nexport default function AnalyticsPage() {\r\n    const [range, setRange] = useState<DateRange>(\"Week\");\r\n    const [data, setData] = useState<AnalyticsData | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        fetch(`/api/analytics?range=${range}`)\r\n            .then((r) => r.json())\r\n            .then((d) => { setData(d); setLoading(false); })\r\n            .catch(() => setLoading(false));\r\n    }, [range]);\r\n\r\n    const formatCurrency = (cents: number) =>\r\n        `R ${(cents / 100).toLocaleString(\"en-ZA\", { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;\r\n\r\n    const barMax = data\r\n        ? Math.max(...data.weeklyBars.map((b) => Math.max(b.storeA, b.storeB)), 1)\r\n        : 1;\r\n\r\n    const totalHealth = (data?.successCount ?? 0) + (data?.failedCount ?? 0) + (data?.pendingCount ?? 0);\r\n    const successPct = totalHealth > 0 ? (data!.successCount / totalHealth) * 100 : 98;\r\n    const failedPct = totalHealth > 0 ? (data!.failedCount / totalHealth) * 100 : 1.5;\r\n\r\n    // SVG donut values (circle circumference ≈ 100.5 for r=16)\r\n    const C = 100.5;\r\n    const successDash = `${(successPct / 100) * C}, ${C}`;\r\n    const failedOffset = -(successPct / 100) * C;\r\n    const failedDash = `${(failedPct / 100) * C}, ${C}`;\r\n\r\n    return (\r\n        <div className=\"flex flex-col min-h-full pb-24\">\r\n            {/* Mobile Header */}\r\n            <header className=\"sticky top-0 z-20 flex md:hidden flex-col bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-4 pt-8 pb-4 gap-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                        <p className=\"text-xs font-semibold text-primary uppercase tracking-wider\">Payment Switch</p>\r\n                        <h1 className=\"text-2xl font-bold tracking-tight\">Analytics</h1>\r\n                    </div>\r\n                    <button className=\"p-2 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors\">\r\n                        <span className=\"material-symbols-outlined\">filter_list</span>\r\n                    </button>\r\n                </div>\r\n                {/* Date Tabs */}\r\n                <div className=\"flex bg-slate-200/50 dark:bg-slate-800/50 p-1 rounded-lg\">\r\n                    {([\"Week\", \"Month\", \"Quarter\", \"Year\"] as DateRange[]).map((r) => (\r\n                        <button\r\n                            key={r}\r\n                            onClick={() => setRange(r)}\r\n                            className={clsx(\r\n                                \"flex-1 py-1.5 text-sm font-medium rounded-md transition-all\",\r\n                                range === r\r\n                                    ? \"bg-white dark:bg-primary text-slate-900 dark:text-white shadow-sm\"\r\n                                    : \"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300\"\r\n                            )}\r\n                        >\r\n                            {r}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </header>\r\n\r\n            {/* Desktop Header */}\r\n            <div className=\"hidden md:flex items-center justify-between mb-6\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Sales & Analytics</h2>\r\n                    </div>\r\n                    <p className=\"text-slate-500 dark:text-slate-400\">Performance overview across all stores</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* Desktop Date Tabs */}\r\n                    <div className=\"flex bg-slate-200/50 dark:bg-slate-800/50 p-1 rounded-lg\">\r\n                        {([\"Week\", \"Month\", \"Quarter\", \"Year\"] as DateRange[]).map((r) => (\r\n                            <button\r\n                                key={r}\r\n                                onClick={() => setRange(r)}\r\n                                className={clsx(\r\n                                    \"px-4 py-1.5 text-sm font-medium rounded-md transition-all\",\r\n                                    range === r\r\n                                        ? \"bg-white dark:bg-primary text-slate-900 dark:text-white shadow-sm\"\r\n                                        : \"text-slate-500 dark:text-slate-400 hover:text-slate-700\"\r\n                                )}\r\n                            >\r\n                                {r}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <button className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-300 font-semibold text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                        <span className=\"material-symbols-outlined text-[20px]\">download</span>\r\n                        Export\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <main className=\"px-4 md:px-0 py-4 md:py-0 space-y-6\">\r\n                {/* Key Metrics Scroll Row */}\r\n                <section className=\"flex gap-4 overflow-x-auto hide-scrollbar -mx-4 px-4 md:mx-0 md:px-0 md:grid md:grid-cols-3\">\r\n                    {[\r\n                        {\r\n                            label: \"Total Volume\",\r\n                            value: loading ? \"—\" : formatCurrency(data?.totalVolume ?? 0),\r\n                            trend: 12.4,\r\n                            up: true\r\n                        },\r\n                        {\r\n                            label: \"Success Rate\",\r\n                            value: loading ? \"—\" : `${(data?.successRate ?? 98.2).toFixed(1)}%`,\r\n                            trend: 0.2,\r\n                            up: false\r\n                        },\r\n                        {\r\n                            label: \"Avg. Ticket\",\r\n                            value: loading ? \"—\" : formatCurrency(data?.avgTicket ?? 0),\r\n                            trend: 4.1,\r\n                            up: true\r\n                        }\r\n                    ].map((metric) => (\r\n                        <div key={metric.label} className=\"flex-none w-40 md:w-auto p-4 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm\">\r\n                            <p className=\"text-xs text-slate-500 dark:text-slate-400 font-medium mb-1\">{metric.label}</p>\r\n                            <h3 className=\"text-xl font-bold\">{metric.value}</h3>\r\n                            <div className={clsx(\"flex items-center mt-2 text-xs font-bold\", metric.up ? \"text-emerald-500\" : \"text-rose-500\")}>\r\n                                <span className=\"material-symbols-outlined text-sm mr-1\">\r\n                                    {metric.up ? \"trending_up\" : \"trending_down\"}\r\n                                </span>\r\n                                {metric.trend}%\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </section>\r\n\r\n                {/* Store Comparison Bar Chart */}\r\n                <section className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <h2 className=\"text-lg font-bold\">Store Comparison</h2>\r\n                        <div className=\"flex gap-3\">\r\n                            <span className=\"flex items-center text-[10px] font-bold uppercase tracking-tighter text-primary\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-primary mr-1\"></span> Primary\r\n                            </span>\r\n                            <span className=\"flex items-center text-[10px] font-bold uppercase tracking-tighter text-slate-400\">\r\n                                <span className=\"w-2 h-2 rounded-full bg-slate-400 mr-1\"></span> Others\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"w-full bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700\">\r\n                        <div className=\"flex items-end justify-between h-32 gap-1\">\r\n                            {loading\r\n                                ? DAY_LABELS.map((d) => (\r\n                                    <div key={d} className=\"flex-1 flex flex-col justify-end gap-1 h-full\">\r\n                                        <div className=\"w-full bg-slate-200 dark:bg-slate-700 rounded-t animate-pulse\" style={{ height: `${Math.random() * 60 + 20}%` }} />\r\n                                        <div className=\"w-full bg-slate-100 dark:bg-slate-600 rounded-t animate-pulse\" style={{ height: `${Math.random() * 40 + 10}%` }} />\r\n                                    </div>\r\n                                ))\r\n                                : (data?.weeklyBars ?? []).map((bar, i) => {\r\n                                    const aH = barMax > 0 ? (bar.storeA / barMax) * 100 : 0;\r\n                                    const bH = barMax > 0 ? (bar.storeB / barMax) * 100 : 0;\r\n                                    return (\r\n                                        <div key={i} className=\"flex-1 flex flex-col justify-end gap-1 h-full group\">\r\n                                            <div className=\"w-full bg-slate-400/20 group-hover:bg-slate-400/40 rounded-t transition-all\" style={{ height: `${Math.max(bH, 4)}%` }} />\r\n                                            <div className=\"w-full bg-primary group-hover:bg-primary/80 rounded-t transition-all\" style={{ height: `${Math.max(aH, 4)}%` }} />\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                        </div>\r\n                        <div className=\"flex justify-between text-[10px] text-slate-400 font-medium pt-2 border-t border-slate-100 dark:border-slate-700\">\r\n                            {DAY_LABELS.map((d) => <span key={d}>{d}</span>)}\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Transaction Health + Top Stores Grid */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    {/* Transaction Health Donut */}\r\n                    <section className=\"bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700\">\r\n                        <h2 className=\"text-sm font-bold text-slate-500 dark:text-slate-400 mb-4 uppercase\">Transaction Health</h2>\r\n                        <div className=\"flex items-center gap-6\">\r\n                            <div className=\"relative flex items-center justify-center w-24 h-24 shrink-0\">\r\n                                <svg className=\"w-full h-full -rotate-90\" viewBox=\"0 0 36 36\">\r\n                                    {/* Track */}\r\n                                    <circle className=\"stroke-slate-200 dark:stroke-slate-700\" cx=\"18\" cy=\"18\" fill=\"none\" r=\"16\" strokeWidth=\"3\" />\r\n                                    {/* Success */}\r\n                                    <circle\r\n                                        className=\"stroke-primary transition-all duration-700\"\r\n                                        cx=\"18\" cy=\"18\" fill=\"none\" r=\"16\"\r\n                                        strokeWidth=\"3\"\r\n                                        strokeDasharray={successDash}\r\n                                    />\r\n                                    {/* Failed */}\r\n                                    <circle\r\n                                        className=\"stroke-rose-500 transition-all duration-700\"\r\n                                        cx=\"18\" cy=\"18\" fill=\"none\" r=\"16\"\r\n                                        strokeWidth=\"3\"\r\n                                        strokeDasharray={failedDash}\r\n                                        strokeDashoffset={failedOffset}\r\n                                    />\r\n                                </svg>\r\n                                <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                                    <span className=\"text-lg font-bold\">{loading ? \"—\" : `${successPct.toFixed(0)}%`}</span>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex-1 space-y-2\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-2 h-2 rounded-full bg-primary\" />\r\n                                        <span className=\"text-xs font-medium\">Successful</span>\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold\">{loading ? \"—\" : (data?.successCount ?? 0).toLocaleString()}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-2 h-2 rounded-full bg-rose-500\" />\r\n                                        <span className=\"text-xs font-medium\">Failed</span>\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold\">{loading ? \"—\" : (data?.failedCount ?? 0).toLocaleString()}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-2 h-2 rounded-full bg-amber-500\" />\r\n                                        <span className=\"text-xs font-medium\">Pending</span>\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold\">{loading ? \"—\" : (data?.pendingCount ?? 0).toLocaleString()}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Top Performing Stores */}\r\n                    <section className=\"space-y-4\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h2 className=\"text-lg font-bold\">Top Performing Units</h2>\r\n                            <Link href=\"/stores\" className=\"text-xs font-semibold text-primary hover:underline\">View All</Link>\r\n                        </div>\r\n                        <div className=\"space-y-3\">\r\n                            {loading ? (\r\n                                [1, 2, 3].map((i) => (\r\n                                    <div key={i} className=\"flex items-center p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 animate-pulse\">\r\n                                        <div className=\"w-10 h-10 rounded-lg bg-slate-200 dark:bg-slate-700\" />\r\n                                        <div className=\"ml-3 flex-1 space-y-2\">\r\n                                            <div className=\"h-3 bg-slate-200 dark:bg-slate-700 rounded w-3/4\" />\r\n                                            <div className=\"h-2 bg-slate-200 dark:bg-slate-700 rounded w-1/2\" />\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            ) : (data?.topStores ?? []).slice(0, 3).map((store, i) => (\r\n                                <div key={store.id} className=\"flex items-center p-3 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 hover:shadow-md transition-shadow\">\r\n                                    <div className={clsx(\r\n                                        \"w-10 h-10 rounded-lg flex items-center justify-center font-bold text-sm\",\r\n                                        i === 0 ? \"bg-primary/10 text-primary\" : \"bg-slate-200 dark:bg-slate-700 text-slate-500\"\r\n                                    )}>\r\n                                        {i + 1}\r\n                                    </div>\r\n                                    <div className=\"ml-3 flex-1 min-w-0\">\r\n                                        <p className=\"text-sm font-bold truncate\">{store.name}</p>\r\n                                        <p className=\"text-[10px] text-slate-500\">{store.count.toLocaleString()} Trans • Yoco Routing</p>\r\n                                    </div>\r\n                                    <div className=\"text-right\">\r\n                                        <p className=\"text-sm font-bold\">{formatCurrency(store.volume)}</p>\r\n                                        <p className={clsx(\"text-[10px] font-medium\", store.trend >= 0 ? \"text-emerald-500\" : \"text-rose-500\")}>\r\n                                            {store.trend >= 0 ? \"+\" : \"\"}{store.trend.toFixed(1)}%\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n\r\n                {/* Gateway Status Banner */}\r\n                <section className=\"flex items-center justify-between p-4 bg-primary/5 dark:bg-primary/10 border border-primary/20 rounded-xl\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"relative flex h-3 w-3\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-3 w-3 bg-emerald-500\"></span>\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-xs font-bold text-primary tracking-wide\">GATEWAY STATUS</p>\r\n                            <p className=\"text-[10px] font-medium opacity-70\">Connected to Yoco Switch Primary</p>\r\n                        </div>\r\n                    </div>\r\n                    <span className=\"material-symbols-outlined text-primary text-xl\">cloud_done</span>\r\n                </section>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\analytics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\fraud\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\ledger\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\process-payment\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2202,2205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2202,2205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { z } from 'zod';\r\nimport { yocoBreaker } from '@/lib/circuitBreaker';\r\nimport { rateLimit } from '@/lib/rateLimit';\r\n\r\n// Validation Schema\r\nconst paymentSchema = z.object({\r\n    amount: z.number().int().positive(),\r\n    currency: z.literal('ZAR'),\r\n    token: z.string().min(1),\r\n    storeId: z.string().uuid(),\r\n    metadata: z.any().optional(),\r\n});\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n\r\n        // 0. Rate Limiting\r\n        const ip = request.headers.get(\"x-forwarded-for\") || \"127.0.0.1\";\r\n        if (!await rateLimit(ip)) {\r\n            return NextResponse.json(\r\n                { success: false, error: \"Too many requests\" },\r\n                { status: 429 }\r\n            );\r\n        }\r\n\r\n        // 1. Validate Input\r\n        const result = paymentSchema.safeParse(body);\r\n        if (!result.success) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Invalid input', details: result.error.flatten() },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const { amount, currency, token, storeId, metadata } = result.data;\r\n\r\n        // 2. Verify Store\r\n        const store = await prisma.store.findUnique({\r\n            where: { id: storeId },\r\n        });\r\n\r\n        if (!store) {\r\n            return NextResponse.json(\r\n                { success: false, error: 'Invalid Store ID' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // 3. Log Pending Transaction\r\n        const transaction = await prisma.transaction.create({\r\n            data: {\r\n                amount,\r\n                currency,\r\n                status: 'PENDING',\r\n                storeId,\r\n                metadata: JSON.stringify(metadata || {}),\r\n            },\r\n        });\r\n\r\n        // 4. Call Yoco API (via Circuit Breaker)\r\n        let yocoResponse: Response;\r\n        try {\r\n            yocoResponse = await yocoBreaker.fire({\r\n                token,\r\n                amountInCents: amount,\r\n                currency,\r\n            }) as Response;\r\n        } catch (err: any) {\r\n            // Circuit Breaker Open or Timeout\r\n            await prisma.transaction.update({\r\n                where: { id: transaction.id },\r\n                data: { status: 'FAILED', metadata: JSON.stringify({ error: err.message }) }\r\n            });\r\n            return NextResponse.json(\r\n                { success: false, error: \"Payment Service Unavailable\", details: err.message },\r\n                { status: 503 }\r\n            );\r\n        }\r\n\r\n        const yocoData = await yocoResponse.json();\r\n\r\n        if (!yocoResponse.ok) {\r\n            // 5a. Handle Failure\r\n            await prisma.transaction.update({\r\n                where: { id: transaction.id },\r\n                data: {\r\n                    status: 'FAILED',\r\n                    metadata: JSON.stringify({ ...metadata, failure_reason: yocoData }),\r\n                },\r\n            });\r\n\r\n            return NextResponse.json(\r\n                { success: false, error: 'Payment Declined', details: yocoData },\r\n                { status: 402 }\r\n            );\r\n        }\r\n\r\n        // 5b. Handle Success\r\n        await prisma.transaction.update({\r\n            where: { id: transaction.id },\r\n            data: {\r\n                status: 'SUCCESS',\r\n                yocoChargeId: yocoData.id,\r\n            },\r\n        });\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            transactionId: transaction.id,\r\n            status: 'SUCCESS',\r\n            chargeId: yocoData.id,\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Payment Switch Error:', error);\r\n        return NextResponse.json(\r\n            { success: false, error: 'Internal Server Error' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\reconciliation\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\refunds\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\stores\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\api\\system\\health\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\fraud\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":36,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Link from \"next/link\";\r\n\r\ntype Sensitivity = \"Low\" | \"Medium\" | \"High\";\r\n\r\ninterface FraudAlert {\r\n    id: string;\r\n    storeName: string;\r\n    reason: string;\r\n    amount: number;\r\n    status: \"Blocked\" | \"Flagged\";\r\n    icon: string;\r\n    iconBg: string;\r\n    time: string;\r\n}\r\n\r\n// Simulated static alerts (fraud data is typically not in the schema)\r\nconst STATIC_ALERTS: FraudAlert[] = [\r\n    { id: \"1\", storeName: \"Store #8829\", reason: \"Velocity Limit Exceeded\", amount: 420000, status: \"Blocked\", icon: \"warning\", iconBg: \"bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400\", time: \"2m ago\" },\r\n    { id: \"2\", storeName: \"Luxe Boutique\", reason: \"Multiple IP Attempts\", amount: 89000, status: \"Flagged\", icon: \"public\", iconBg: \"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400\", time: \"14m ago\" },\r\n    { id: \"3\", storeName: \"Tech Hub ZA\", reason: \"Card Testing Detected\", amount: 1200, status: \"Blocked\", icon: \"credit_card\", iconBg: \"bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400\", time: \"32m ago\" },\r\n    { id: \"4\", storeName: \"Fresh Market\", reason: \"Unusual Transaction Pattern\", amount: 550000, status: \"Flagged\", icon: \"analytics\", iconBg: \"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400\", time: \"1h ago\" },\r\n    { id: \"5\", storeName: \"SwiftPay Terminal\", reason: \"Geographic Anomaly\", amount: 210000, status: \"Blocked\", icon: \"location_off\", iconBg: \"bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400\", time: \"2h ago\" },\r\n];\r\n\r\nexport default function FraudPage() {\r\n    const [sensitivity, setSensitivity] = useState<Sensitivity>(\"Medium\");\r\n    const [autoBlock, setAutoBlock] = useState(true);\r\n    const [alerts, setAlerts] = useState<FraudAlert[]>([]);\r\n    const [riskScore, setRiskScore] = useState(0);\r\n    const [metrics, setMetrics] = useState({ flagged: 0, blocked: 0, saved: 0 });\r\n    const [clearing, setClearing] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Fetch real fraud data on mount\r\n    useEffect(() => {\r\n        fetch(\"/api/fraud\")\r\n            .then((r) => r.json())\r\n            .then((data) => {\r\n                setRiskScore(data.riskScore ?? 12);\r\n                setMetrics({\r\n                    flagged: data.flagged ?? 0,\r\n                    blocked: data.blocked ?? 0,\r\n                    saved: data.savedCents ?? 0,\r\n                });\r\n                setAlerts(data.alerts ?? []);\r\n            })\r\n            .catch(() => {\r\n                // silently keep defaults on network error\r\n                setAlerts(STATIC_ALERTS);\r\n                setRiskScore(12);\r\n                setMetrics({ flagged: 24, blocked: 8, saved: 1520000 });\r\n            })\r\n            .finally(() => setLoading(false));\r\n    }, []);\r\n\r\n    // Compute risk score label\r\n    const riskLabel = riskScore < 30 ? \"Low Risk\" : riskScore < 60 ? \"Medium Risk\" : \"High Risk\";\r\n    const riskColor = riskScore < 30 ? \"text-emerald-500\" : riskScore < 60 ? \"text-amber-500\" : \"text-rose-500\";\r\n\r\n    // SVG gauge: r=58, circumference = 2π×58 = 364.4\r\n    const C = 364.4;\r\n    const dashOffset = C - (riskScore / 100) * C;\r\n\r\n    const handleClearAlerts = async () => {\r\n        setClearing(true);\r\n        await new Promise((r) => setTimeout(r, 1200));\r\n        setAlerts([]);\r\n        setMetrics((m) => ({ ...m, flagged: 0 }));\r\n        setRiskScore(Math.max(0, riskScore - 8));\r\n        setClearing(false);\r\n    };\r\n\r\n    const formatAmount = (cents: number) =>\r\n        `R ${(cents / 100).toLocaleString(\"en-ZA\", { minimumFractionDigits: 0 })}`;\r\n\r\n    return (\r\n        <div className=\"flex flex-col min-h-full pb-40 md:pb-8\">\r\n            {/* Mobile Header */}\r\n            <header className=\"sticky top-0 z-20 flex md:hidden items-center justify-between bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-slate-200 dark:border-primary/20 px-4 py-4\">\r\n                <Link href=\"/\" className=\"flex items-center text-primary\">\r\n                    <span className=\"material-symbols-outlined\">chevron_left</span>\r\n                    <span className=\"text-lg font-medium\">Back</span>\r\n                </Link>\r\n                <h1 className=\"text-lg font-bold tracking-tight\">Fraud Monitoring</h1>\r\n                <button className=\"text-primary\">\r\n                    <span className=\"material-symbols-outlined\">tune</span>\r\n                </button>\r\n            </header>\r\n\r\n            {/* Desktop Header */}\r\n            <div className=\"hidden md:flex items-center justify-between mb-6\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Fraud Detection</h2>\r\n                    <p className=\"text-slate-500 dark:text-slate-400\">Real-time risk monitoring across all stores</p>\r\n                </div>\r\n                <button className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-300 font-semibold text-sm hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-[20px]\">tune</span>\r\n                    Configure Rules\r\n                </button>\r\n            </div>\r\n\r\n            <main className=\"flex-1 pb-4 space-y-6\">\r\n                {/* Risk Score Gauge */}\r\n                <section className=\"px-4 md:px-0\">\r\n                    <div className=\"rounded-xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-primary/10 p-6 flex flex-col items-center shadow-sm\">\r\n                        <div className=\"relative flex items-center justify-center w-32 h-32\">\r\n                            <svg className=\"w-full h-full transform -rotate-90\" viewBox=\"0 0 128 128\">\r\n                                {/* Track */}\r\n                                <circle\r\n                                    className=\"text-slate-100 dark:text-slate-800\"\r\n                                    cx=\"64\" cy=\"64\"\r\n                                    fill=\"transparent\" r=\"58\"\r\n                                    stroke=\"currentColor\" strokeWidth=\"8\"\r\n                                />\r\n                                {/* Progress */}\r\n                                <circle\r\n                                    className={clsx(\"transition-all duration-700\",\r\n                                        riskScore < 30 ? \"text-emerald-500\" : riskScore < 60 ? \"text-amber-500\" : \"text-rose-500\"\r\n                                    )}\r\n                                    cx=\"64\" cy=\"64\"\r\n                                    fill=\"transparent\" r=\"58\"\r\n                                    stroke=\"currentColor\"\r\n                                    strokeWidth=\"8\"\r\n                                    strokeLinecap=\"round\"\r\n                                    strokeDasharray={C}\r\n                                    strokeDashoffset={dashOffset}\r\n                                />\r\n                            </svg>\r\n                            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                                <span className=\"text-3xl font-bold\">{riskScore}</span>\r\n                                <span className={clsx(\"text-[10px] uppercase tracking-widest font-semibold\", riskColor)}>\r\n                                    {riskLabel}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"mt-4 text-center\">\r\n                            <h2 className=\"text-xl font-bold\">Fraud Risk Score</h2>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400 mt-1\">Aggregated across all Yoco routes</p>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Metrics Scroll */}\r\n                <section className=\"flex gap-4 px-4 md:px-0 overflow-x-auto hide-scrollbar -mx-0 md:grid md:grid-cols-3\">\r\n                    {[\r\n                        { label: \"Flagged\", value: metrics.flagged.toString(), trend: \"trending_down\", trendColor: \"text-emerald-500\", trendText: \"5%\" },\r\n                        { label: \"Blocked\", value: metrics.blocked.toString(), trend: null, trendText: \"Stable\", trendColor: \"text-slate-400\" },\r\n                        { label: \"Saved\", value: `R ${(metrics.saved / 100 / 1000).toFixed(1)}k`, trend: \"trending_up\", trendColor: \"text-emerald-500\", trendText: \"12%\" },\r\n                    ].map((m) => (\r\n                        <div key={m.label} className=\"flex min-w-[140px] flex-col gap-1 rounded-xl p-4 bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-primary/10 shadow-sm\">\r\n                            <span className=\"text-slate-500 dark:text-slate-400 text-xs font-medium\">{m.label}</span>\r\n                            <span className=\"text-2xl font-bold\">{m.value}</span>\r\n                            <span className={clsx(\"text-xs font-semibold flex items-center gap-0.5\", m.trendColor)}>\r\n                                {m.trend && <span className=\"material-symbols-outlined text-sm\">{m.trend}</span>}\r\n                                {m.trendText}\r\n                            </span>\r\n                        </div>\r\n                    ))}\r\n                </section>\r\n\r\n                {/* Sensitivity Controls */}\r\n                <section className=\"px-4 md:px-0\">\r\n                    <div className=\"rounded-xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-primary/10 p-4 shadow-sm\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div>\r\n                                <h3 className=\"font-bold text-base\">Auto-block Sensitivity</h3>\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400\">Current setting: {sensitivity}</p>\r\n                            </div>\r\n                            {/* Toggle */}\r\n                            <button\r\n                                onClick={() => setAutoBlock(!autoBlock)}\r\n                                className={clsx(\r\n                                    \"flex h-8 w-14 items-center rounded-full p-1 transition-colors duration-300\",\r\n                                    autoBlock ? \"bg-primary\" : \"bg-slate-300 dark:bg-slate-700\"\r\n                                )}\r\n                            >\r\n                                <div className={clsx(\r\n                                    \"h-6 w-6 rounded-full bg-white shadow-sm transition-transform duration-300\",\r\n                                    autoBlock ? \"translate-x-6\" : \"translate-x-0\"\r\n                                )} />\r\n                            </button>\r\n                        </div>\r\n                        {/* Sensitivity Segmented Control */}\r\n                        <div className={clsx(\"flex p-1 bg-slate-100 dark:bg-slate-800 rounded-lg transition-opacity\", !autoBlock && \"opacity-40 pointer-events-none\")}>\r\n                            {([\"Low\", \"Medium\", \"High\"] as Sensitivity[]).map((s) => (\r\n                                <button\r\n                                    key={s}\r\n                                    onClick={() => setSensitivity(s)}\r\n                                    className={clsx(\r\n                                        \"flex-1 py-1.5 text-xs font-semibold rounded-md transition-all\",\r\n                                        sensitivity === s\r\n                                            ? \"bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 shadow-sm\"\r\n                                            : \"text-slate-500 dark:text-slate-400\"\r\n                                    )}\r\n                                >\r\n                                    {s}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Alerts List */}\r\n                <section className=\"px-4 md:px-0\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                        <h3 className=\"text-lg font-bold\">Recent Alerts</h3>\r\n                        <button className=\"text-primary text-sm font-semibold hover:underline\">View All</button>\r\n                    </div>\r\n                    <div className=\"space-y-3\">\r\n                        {alerts.length === 0 ? (\r\n                            <div className=\"text-center py-12 text-slate-400\">\r\n                                <span className=\"material-symbols-outlined text-4xl mb-2 block text-emerald-500\">verified_user</span>\r\n                                <p className=\"font-semibold text-emerald-600 dark:text-emerald-400\">All clear! No active alerts.</p>\r\n                                <p className=\"text-sm mt-1\">The system is monitoring all transactions.</p>\r\n                            </div>\r\n                        ) : alerts.map((alert) => (\r\n                            <div key={alert.id} className=\"flex items-center gap-4 p-4 rounded-xl bg-white dark:bg-slate-900/50 border border-slate-200 dark:border-primary/10 shadow-sm hover:shadow-md transition-shadow\">\r\n                                <div className={clsx(\"flex h-12 w-12 shrink-0 items-center justify-center rounded-full\", alert.iconBg)}>\r\n                                    <span className=\"material-symbols-outlined\">{alert.icon}</span>\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"font-bold truncate\">{alert.storeName}</span>\r\n                                        <span className=\"text-xs font-medium text-slate-500 dark:text-slate-400 shrink-0 ml-2\">{alert.time}</span>\r\n                                    </div>\r\n                                    <p className=\"text-sm text-slate-500 dark:text-slate-400 font-medium\">{alert.reason}</p>\r\n                                    <div className=\"mt-1 flex items-center justify-between\">\r\n                                        <span className=\"text-sm font-bold\">{formatAmount(alert.amount)}</span>\r\n                                        <span className={clsx(\r\n                                            \"rounded-full px-2 py-0.5 text-[10px] font-bold uppercase\",\r\n                                            alert.status === \"Blocked\"\r\n                                                ? \"bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400\"\r\n                                                : \"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400\"\r\n                                        )}>\r\n                                            {alert.status}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </section>\r\n            </main>\r\n\r\n            {/* Sticky Bottom CTA - Mobile */}\r\n            <div className={clsx(\r\n                \"fixed bottom-0 left-0 right-0 z-30 bg-background-light dark:bg-background-dark border-t border-slate-200 dark:border-primary/20 px-4 pt-4 pb-6 md:hidden\",\r\n                alerts.length === 0 && \"opacity-50 pointer-events-none\"\r\n            )}>\r\n                <button\r\n                    onClick={handleClearAlerts}\r\n                    disabled={clearing || alerts.length === 0}\r\n                    className=\"w-full flex items-center justify-center gap-2 rounded-xl bg-primary py-4 font-bold text-white shadow-lg active:scale-95 disabled:opacity-60 transition-all\"\r\n                >\r\n                    <span className={clsx(\"material-symbols-outlined\", clearing && \"animate-spin\")}>\r\n                        {clearing ? \"progress_activity\" : \"done_all\"}\r\n                    </span>\r\n                    {clearing ? \"Clearing...\" : `Review & Clear ${alerts.length} Alert${alerts.length !== 1 ? \"s\" : \"\"}`}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Desktop CTA */}\r\n            {alerts.length > 0 && (\r\n                <div className=\"hidden md:block mt-4 px-0\">\r\n                    <button\r\n                        onClick={handleClearAlerts}\r\n                        disabled={clearing}\r\n                        className=\"flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl font-bold shadow-lg shadow-primary/20 hover:opacity-90 active:scale-[0.98] disabled:opacity-60 transition-all\"\r\n                    >\r\n                        <span className={clsx(\"material-symbols-outlined text-[20px]\", clearing && \"animate-spin\")}>\r\n                            {clearing ? \"progress_activity\" : \"done_all\"}\r\n                        </span>\r\n                        {clearing ? \"Clearing...\" : `Review & Clear ${alerts.length} Alerts`}\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\layout.tsx","messages":[{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":25,"column":9,"nodeType":"JSXOpeningElement","endLine":28,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from \"next\";\nimport { Inter } from \"next/font/google\";\nimport \"./globals.css\";\nimport { AppShell } from \"@/components/layout/AppShell\";\n\nconst inter = Inter({\n  variable: \"--font-inter\",\n  subsets: [\"latin\"],\n  display: \"swap\",\n});\n\nexport const metadata: Metadata = {\n  title: \"UrbanSmart Payment Switch\",\n  description: \"Payment Switch Dashboard\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <link\n          href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\"\n          rel=\"stylesheet\"\n        />\n      </head>\n      <body className={`${inter.variable} antialiased bg-background text-foreground`}>\n        <AppShell>\n          {children}\n        </AppShell>\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\ledger\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\payment\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\reconciliation\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":48,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":19},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\reconciliation\\page.tsx:67:9\n  65 |\n  66 |     useEffect(() => {\n> 67 |         loadData();\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  68 |     }, []);\n  69 |\n  70 |     const handleSync = async () => {","line":67,"column":9,"nodeType":null,"endLine":67,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'unresolvedItems' is assigned a value but never used.","line":86,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport Link from \"next/link\";\r\n\r\ntype ViewTab = \"Overview\" | \"Issues\" | \"History\";\r\ntype DiscrepancyType = \"MISMATCH\" | \"NOT_FOUND\" | \"MATCHED\";\r\n\r\ninterface DiscrepancyItem {\r\n    id: string;\r\n    chargeId: string;\r\n    date: string;\r\n    type: DiscrepancyType;\r\n    platformAmount: number | null;\r\n    yocoAmount: number | null;\r\n    note: string;\r\n    resolved: boolean;\r\n}\r\n\r\n// Static reconciliation items (these represent cross-system comparison data)\r\nconst STATIC_ITEMS: DiscrepancyItem[] = [\r\n    { id: \"1\", chargeId: \"CH_0X92K182L\", date: \"Oct 24, 2023 • 14:22\", type: \"MISMATCH\", platformAmount: 145000, yocoAmount: 120000, note: \"Possible partial refund not recorded locally.\", resolved: false },\r\n    { id: \"2\", chargeId: \"YOCO_M82L9P\", date: \"Oct 24, 2023 • 15:01\", type: \"NOT_FOUND\", platformAmount: null, yocoAmount: 49900, note: \"External transaction detected.\", resolved: false },\r\n    { id: \"3\", chargeId: \"CH_P832MM1\", date: \"Oct 24, 2023 • 13:45\", type: \"MATCHED\", platformAmount: 82000, yocoAmount: 82000, note: \"Amounts match.\", resolved: true },\r\n    { id: \"4\", chargeId: \"CH_8XP29Q4R\", date: \"Oct 23, 2023 • 09:15\", type: \"MISMATCH\", platformAmount: 220000, yocoAmount: 185000, note: \"Potential fee discrepancy on refund.\", resolved: false },\r\n    { id: \"5\", chargeId: \"YOCO_K901AS\", date: \"Oct 23, 2023 • 11:30\", type: \"NOT_FOUND\", platformAmount: null, yocoAmount: 67500, note: \"Yoco charge has no local record.\", resolved: false },\r\n];\r\n\r\nconst DRIFT_BARS = [\r\n    { h: \"80%\", color: \"bg-primary\" },\r\n    { h: \"60%\", color: \"bg-primary/40\" },\r\n    { h: \"30%\", color: \"bg-rose-500\" },\r\n    { h: \"90%\", color: \"bg-primary\" },\r\n    { h: \"45%\", color: \"bg-primary/60\" },\r\n    { h: \"70%\", color: \"bg-primary/80\" },\r\n    { h: \"55%\", color: \"bg-primary/50\" },\r\n];\r\n\r\nconst fmt = (cents: number) => `R ${(cents / 100).toLocaleString(\"en-ZA\", { minimumFractionDigits: 2 })}`;\r\n\r\nexport default function ReconciliationPage() {\r\n    const [activeTab, setActiveTab] = useState<ViewTab>(\"Issues\");\r\n    const [items, setItems] = useState<DiscrepancyItem[]>(STATIC_ITEMS);\r\n    const [syncing, setSyncing] = useState(false);\r\n    const [lastSync, setLastSync] = useState(\"2m ago\");\r\n    const [dbStats, setDbStats] = useState({ total: 0, discrepancies: 0 });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const loadData = () => {\r\n        setLoading(true);\r\n        fetch(\"/api/reconciliation\")\r\n            .then((r) => r.json())\r\n            .then((data) => {\r\n                if (data.totalVolume !== undefined) {\r\n                    setDbStats({ total: data.totalVolume, discrepancies: data.discrepancyCount });\r\n                }\r\n                if (Array.isArray(data.items) && data.items.length > 0) {\r\n                    setItems(data.items);\r\n                }\r\n            })\r\n            .catch(() => { })\r\n            .finally(() => setLoading(false));\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const handleSync = async () => {\r\n        setSyncing(true);\r\n        await new Promise((r) => setTimeout(r, 1000));\r\n        loadData();\r\n        setSyncing(false);\r\n        setLastSync(\"just now\");\r\n    };\r\n\r\n    const handleFix = (id: string) => {\r\n        setItems((prev) => prev.map((item) => item.id === id ? { ...item, resolved: true, type: \"MATCHED\" } : item));\r\n    };\r\n\r\n    const handleImport = (id: string) => {\r\n        setItems((prev) => prev.map((item) => item.id === id ? { ...item, resolved: true, type: \"MATCHED\", platformAmount: item.yocoAmount } : item));\r\n    };\r\n\r\n    const unresolvedItems = items.filter((i) => !i.resolved && activeTab === \"Issues\");\r\n    const historyItems = items.filter((i) => i.resolved);\r\n    const displayItems = activeTab === \"Issues\" ? items.filter((i) => !i.resolved) : activeTab === \"History\" ? historyItems : items;\r\n\r\n    return (\r\n        <div className=\"flex flex-col min-h-full bg-background-dark text-slate-100\">\r\n            {/* Mobile Header */}\r\n            <header className=\"sticky top-0 z-20 flex md:hidden items-center justify-between bg-background-dark/80 backdrop-blur-md border-b border-slate-700/50 p-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Link href=\"/\" className=\"flex size-10 items-center justify-center rounded-lg bg-slate-800 text-slate-100\">\r\n                        <span className=\"material-symbols-outlined\">arrow_back_ios_new</span>\r\n                    </Link>\r\n                    <div>\r\n                        <h1 className=\"text-lg font-bold leading-tight\">Ledger Tool</h1>\r\n                        <p className=\"text-xs text-slate-400 font-medium\">Store: Main Terminal 01</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button className=\"flex size-10 items-center justify-center rounded-lg bg-slate-800 text-slate-100 hover:bg-slate-700 transition-colors\">\r\n                        <span className=\"material-symbols-outlined\">search</span>\r\n                    </button>\r\n                    <button className=\"flex size-10 items-center justify-center rounded-lg bg-slate-800 text-slate-100 hover:bg-slate-700 transition-colors\">\r\n                        <span className=\"material-symbols-outlined\">filter_list</span>\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Desktop Header */}\r\n            <div className=\"hidden md:flex items-center justify-between mb-6\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-white\">Reconciliation Tool</h2>\r\n                    <p className=\"text-slate-400\">Compare platform ledger vs. Yoco API data</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={handleSync}\r\n                        disabled={syncing}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg text-sm font-semibold hover:opacity-90 disabled:opacity-60 transition-all shadow-lg shadow-primary/20\"\r\n                    >\r\n                        <span className={clsx(\"material-symbols-outlined text-[18px]\", syncing && \"animate-spin\")}>\r\n                            {syncing ? \"progress_activity\" : \"sync\"}\r\n                        </span>\r\n                        {syncing ? \"Syncing...\" : \"Manual Sync\"}\r\n                    </button>\r\n                    <button className=\"flex items-center gap-2 px-4 py-2 bg-slate-800 text-slate-200 border border-slate-700 rounded-lg text-sm font-semibold hover:bg-slate-700 transition-colors\">\r\n                        <span className=\"material-symbols-outlined text-[18px]\">download</span>\r\n                        Export\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <main className=\"flex-1 pb-8 space-y-4\">\r\n                {/* Batch Summary Card */}\r\n                <section className=\"px-4 md:px-0\">\r\n                    <div className=\"rounded-xl bg-slate-800/60 p-5 border border-slate-700/50 relative overflow-hidden group\">\r\n                        <div className=\"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity pointer-events-none\">\r\n                            <span className=\"material-symbols-outlined text-6xl\">receipt_long</span>\r\n                        </div>\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"flex items-center justify-between mb-4\">\r\n                                <span className=\"px-2 py-1 bg-primary/20 text-primary text-[10px] font-bold uppercase tracking-wider rounded\">\r\n                                    Batch #8829-Yoco\r\n                                </span>\r\n                                <span className=\"text-slate-400 text-xs\">Updated {lastSync}</span>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div>\r\n                                    <p className=\"text-slate-400 text-xs font-medium uppercase tracking-wide\">Total Volume</p>\r\n                                    <p className=\"text-2xl font-bold text-slate-100\">\r\n                                        {dbStats.total > 0 ? fmt(dbStats.total) : \"R 142,500\"}\r\n                                    </p>\r\n                                </div>\r\n                                <div>\r\n                                    <p className=\"text-rose-400 text-xs font-medium uppercase tracking-wide\">Discrepancies</p>\r\n                                    <p className=\"text-2xl font-bold text-rose-400\">\r\n                                        {dbStats.discrepancies > 0 ? `${dbStats.discrepancies} Items` : `${items.filter((i) => !i.resolved).length} Items`}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-4 flex items-center gap-3\">\r\n                                <button\r\n                                    onClick={handleSync}\r\n                                    disabled={syncing}\r\n                                    className=\"flex-1 flex items-center justify-center gap-2 rounded-lg bg-primary py-2.5 text-sm font-bold text-white shadow-lg shadow-primary/20 hover:bg-primary/90 disabled:opacity-60 transition-all active:scale-95\"\r\n                                >\r\n                                    <span className={clsx(\"material-symbols-outlined text-sm\", syncing && \"animate-spin\")}>\r\n                                        {syncing ? \"progress_activity\" : \"sync\"}\r\n                                    </span>\r\n                                    {syncing ? \"Syncing...\" : \"Manual Sync\"}\r\n                                </button>\r\n                                <button className=\"size-10 flex items-center justify-center rounded-lg bg-slate-700 text-slate-300 hover:text-white transition-colors\">\r\n                                    <span className=\"material-symbols-outlined\">download</span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Segmented Control */}\r\n                <div className=\"px-4 md:px-0 sticky top-[73px] md:top-0 z-10 bg-background-dark/95 backdrop-blur-sm py-2\">\r\n                    <div className=\"flex h-11 items-center justify-center rounded-xl bg-slate-800 p-1 border border-slate-700\">\r\n                        {([\"Overview\", \"Issues\", \"History\"] as ViewTab[]).map((tab) => (\r\n                            <button\r\n                                key={tab}\r\n                                onClick={() => setActiveTab(tab)}\r\n                                className={clsx(\r\n                                    \"flex h-full flex-1 items-center justify-center rounded-lg text-sm font-semibold transition-all\",\r\n                                    activeTab === tab\r\n                                        ? \"bg-background-dark text-primary\"\r\n                                        : \"text-slate-400 hover:text-slate-200\"\r\n                                )}\r\n                            >\r\n                                {tab}\r\n                                {tab === \"Issues\" && items.filter((i) => !i.resolved).length > 0 && (\r\n                                    <span className=\"ml-1.5 bg-rose-500 text-white text-[9px] font-bold rounded-full w-4 h-4 flex items-center justify-center\">\r\n                                        {items.filter((i) => !i.resolved).length}\r\n                                    </span>\r\n                                )}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Items List */}\r\n                {activeTab !== \"Overview\" && (\r\n                    <div className=\"px-4 md:px-0 space-y-3\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <h3 className=\"text-sm font-bold uppercase tracking-widest text-slate-300\">\r\n                                {activeTab === \"Issues\" ? \"Unresolved Items\" : \"Resolved Items\"}\r\n                            </h3>\r\n                            <span className=\"text-slate-500 text-xs font-medium\">Sorted by: Amount (High-Low)</span>\r\n                        </div>\r\n                        {displayItems.length === 0 && (\r\n                            <div className=\"text-center py-12 text-slate-400\">\r\n                                <span className=\"material-symbols-outlined text-4xl block mb-2 text-emerald-500\">check_circle</span>\r\n                                <p className=\"font-semibold text-emerald-400\">All items reconciled!</p>\r\n                            </div>\r\n                        )}\r\n                        {displayItems.map((item) => {\r\n                            const isResolved = item.type === \"MATCHED\";\r\n                            return (\r\n                                <div key={item.id} className={clsx(\r\n                                    \"rounded-xl border p-4 space-y-3\",\r\n                                    isResolved\r\n                                        ? \"border-slate-700/40 bg-slate-800/20 opacity-60\"\r\n                                        : \"border-rose-500/30 bg-rose-500/5\"\r\n                                )}>\r\n                                    <div className=\"flex justify-between items-start\">\r\n                                        <div>\r\n                                            <p className=\"text-xs font-mono text-slate-400\">ID: {item.chargeId}</p>\r\n                                            <p className=\"text-sm font-bold text-slate-100\">{item.date}</p>\r\n                                        </div>\r\n                                        <span className={clsx(\r\n                                            \"flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-bold\",\r\n                                            item.type === \"MISMATCH\" && \"bg-rose-500 text-white\",\r\n                                            item.type === \"NOT_FOUND\" && \"bg-rose-500 text-white\",\r\n                                            item.type === \"MATCHED\" && \"bg-emerald-500/20 text-emerald-400\"\r\n                                        )}>\r\n                                            <span className=\"material-symbols-outlined text-[12px]\">\r\n                                                {item.type === \"MATCHED\" ? \"check_circle\" : item.type === \"NOT_FOUND\" ? \"search_off\" : \"warning\"}\r\n                                            </span>\r\n                                            {item.type}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-2 bg-background-dark/40 rounded-lg p-3 border border-slate-700/50\">\r\n                                        <div className=\"border-r border-slate-700/50 pr-2\">\r\n                                            <p className=\"text-[10px] uppercase text-slate-500 font-bold mb-1\">Platform Ledger</p>\r\n                                            {item.platformAmount !== null\r\n                                                ? <p className={clsx(\"text-lg font-bold\", isResolved ? \"text-slate-400\" : \"text-slate-100\")}>{fmt(item.platformAmount)}</p>\r\n                                                : <p className=\"text-lg font-bold text-slate-500 italic\">Missing</p>\r\n                                            }\r\n                                        </div>\r\n                                        <div className=\"pl-2\">\r\n                                            <p className=\"text-[10px] uppercase text-slate-500 font-bold mb-1\">Yoco API</p>\r\n                                            <p className={clsx(\"text-lg font-bold\", isResolved ? \"text-slate-400\" : item.type === \"MISMATCH\" ? \"text-rose-400\" : \"text-slate-100\")}>\r\n                                                {item.yocoAmount !== null ? fmt(item.yocoAmount) : \"—\"}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    {!isResolved && (\r\n                                        <div className=\"flex items-center justify-between pt-1\">\r\n                                            <p className=\"text-[11px] text-slate-400 italic\">{item.note}</p>\r\n                                            {item.type === \"MISMATCH\" && (\r\n                                                <button onClick={() => handleFix(item.id)} className=\"text-primary text-xs font-bold flex items-center gap-1 hover:underline\">\r\n                                                    Fix <span className=\"material-symbols-outlined text-xs\">arrow_forward</span>\r\n                                                </button>\r\n                                            )}\r\n                                            {item.type === \"NOT_FOUND\" && (\r\n                                                <button onClick={() => handleImport(item.id)} className=\"text-primary text-xs font-bold flex items-center gap-1 hover:underline\">\r\n                                                    Import <span className=\"material-symbols-outlined text-xs\">download</span>\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Overview Tab — Drift Analysis */}\r\n                {activeTab === \"Overview\" && (\r\n                    <div className=\"px-4 md:px-0 space-y-4\">\r\n                        <h3 className=\"text-sm font-bold uppercase tracking-widest text-slate-300\">Drift Analysis</h3>\r\n                        <div className=\"w-full bg-slate-800/60 rounded-xl p-5 border border-slate-700/50 relative overflow-hidden\">\r\n                            <div\r\n                                className=\"absolute inset-0 opacity-10 pointer-events-none\"\r\n                                style={{ backgroundImage: \"radial-gradient(circle at 2px 2px, #135bec 1px, transparent 0)\", backgroundSize: \"20px 20px\" }}\r\n                            />\r\n                            <div className=\"flex items-end gap-3 h-24 mb-4\">\r\n                                {DRIFT_BARS.map((bar, i) => (\r\n                                    <div key={i} className={clsx(\"flex-1 rounded-t-sm transition-all\", bar.color)} style={{ height: bar.h }} />\r\n                                ))}\r\n                            </div>\r\n                            <p className=\"text-xs text-slate-400 font-medium text-center\">Daily reconciliation drift (last 7 days)</p>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-3 gap-3\">\r\n                            {[\r\n                                { label: \"Matched\", value: items.filter((i) => i.type === \"MATCHED\").length, color: \"text-emerald-400\" },\r\n                                { label: \"Mismatches\", value: items.filter((i) => i.type === \"MISMATCH\" && !i.resolved).length, color: \"text-rose-400\" },\r\n                                { label: \"Not Found\", value: items.filter((i) => i.type === \"NOT_FOUND\" && !i.resolved).length, color: \"text-amber-400\" },\r\n                            ].map((stat) => (\r\n                                <div key={stat.label} className=\"bg-slate-800/60 rounded-xl p-4 border border-slate-700/50 text-center\">\r\n                                    <p className={clsx(\"text-2xl font-bold\", stat.color)}>{stat.value}</p>\r\n                                    <p className=\"text-[10px] text-slate-500 font-medium uppercase tracking-wide mt-1\">{stat.label}</p>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\refunds\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\settings\\api\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\settings\\team\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\settings\\webhooks\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\stores\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\system\\health\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\app\\transactions\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\layout\\AppShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\layout\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\layout\\PageTransition.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\payment\\YocoPayment.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[34,45],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":58,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Script from \"next/script\";\r\n\r\ninterface YocoPaymentProps {\r\n    amountInCents: number;\r\n    currency?: \"ZAR\";\r\n    storeId: string;\r\n}\r\n\r\nexport function YocoPayment({ amountInCents, currency = \"ZAR\", storeId }: YocoPaymentProps) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [sdkReady, setSdkReady] = useState(false);\r\n\r\n    const handlePay = async () => {\r\n        if (!window.YocoSDK) {\r\n            setError(\"Payment system initializing...\");\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        const yoco = new window.YocoSDK({\r\n            publicKey: process.env.NEXT_PUBLIC_YOCO_PUBLIC_KEY || \"pk_test_ed3c54a6gOol69QA7f45\", // Fallback test key\r\n        });\r\n\r\n        yoco.showPopup({\r\n            amountInCents,\r\n            currency,\r\n            name: \"UrbanSmart Store\",\r\n            description: \"Payment for order\",\r\n            callback: async (result) => {\r\n                if (result.error) {\r\n                    setError(result.error.message);\r\n                    setLoading(false);\r\n                } else {\r\n                    // Send token to backend\r\n                    try {\r\n                        const response = await fetch(\"/api/process-payment\", {\r\n                            method: \"POST\",\r\n                            headers: { \"Content-Type\": \"application/json\" },\r\n                            body: JSON.stringify({\r\n                                token: result.id,\r\n                                amount: amountInCents,\r\n                                currency,\r\n                                storeId,\r\n                            }),\r\n                        });\r\n                        const data = await response.json();\r\n                        if (data.success) {\r\n                            alert(\"Payment Successful! Transaction ID: \" + data.transactionId);\r\n                        } else {\r\n                            setError(\"Payment failed on server: \" + data.error);\r\n                        }\r\n                    } catch (err) {\r\n                        setError(\"Network error processing payment\");\r\n                    } finally {\r\n                        setLoading(false);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700\">\r\n            <Script\r\n                src=\"https://js.yoco.com/sdk/v1/yoco-sdk-web.js\"\r\n                onLoad={() => setSdkReady(true)}\r\n            />\r\n\r\n            <div className=\"flex flex-col gap-4\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-slate-500 dark:text-slate-400 font-medium\">Total to Pay</span>\r\n                    <span className=\"text-2xl font-bold text-slate-900 dark:text-white\">\r\n                        {(amountInCents / 100).toLocaleString(\"en-ZA\", { style: \"currency\", currency: \"ZAR\" })}\r\n                    </span>\r\n                </div>\r\n\r\n                {error && (\r\n                    <div className=\"p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-lg flex items-center gap-2\">\r\n                        <span className=\"material-symbols-outlined text-sm\">error</span>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                <button\r\n                    onClick={handlePay}\r\n                    disabled={loading || !sdkReady}\r\n                    className=\"w-full py-4 bg-primary hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-primary/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\r\n                >\r\n                    {loading ? (\r\n                        <span className=\"size-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"></span>\r\n                    ) : (\r\n                        <>\r\n                            <span className=\"material-symbols-outlined\">credit_card</span>\r\n                            Pay Securely\r\n                        </>\r\n                    )}\r\n                </button>\r\n\r\n                <div className=\"flex justify-center gap-2 opacity-50\">\r\n                    {/* Logic for payment icons could go here */}\r\n                    <span className=\"text-[10px] text-slate-400 font-semibold uppercase tracking-wider\">Secured by Yoco</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\ui\\PerformanceChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\ui\\SummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\components\\ui\\TransactionList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\lib\\circuitBreaker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83,86],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83,86],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import CircuitBreaker from 'opossum';\r\n\r\nconst performYocoCharge = async (payload: any) => {\r\n    const response = await fetch('https://online.yoco.com/v1/charges/', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'X-Auth-Secret-Key': process.env.YOCO_SECRET_KEY || '',\r\n        },\r\n        body: JSON.stringify(payload),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        if (response.status >= 500) {\r\n            throw new Error(`Yoco API Server Error: ${response.status}`);\r\n        }\r\n        // 4xx errors are \"success\" in terms of circuit breaker (client error, not service down)\r\n        return response;\r\n    }\r\n\r\n    return response;\r\n};\r\n\r\nconst options = {\r\n    timeout: 5000, // If function takes longer than 5 seconds, trigger failure\r\n    errorThresholdPercentage: 50, // When 50% of requests fail, trip the breaker\r\n    resetTimeout: 30000 // After 30 seconds, try again.\r\n};\r\n\r\nexport const yocoBreaker = new CircuitBreaker(performYocoCharge, options);\r\n\r\nyocoBreaker.fallback(() => {\r\n    return new Response(JSON.stringify({ error: \"Payment Service Temporarily Unavailable\" }), {\r\n        status: 503,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\lib\\rateLimit.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rejRes' is defined but never used.","line":12,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { RateLimiterMemory } from 'rate-limiter-flexible';\r\n\r\nconst rateLimiter = new RateLimiterMemory({\r\n    points: 10, // 10 requests\r\n    duration: 60, // Per 60 seconds\r\n});\r\n\r\nexport async function rateLimit(ip: string) {\r\n    try {\r\n        await rateLimiter.consume(ip);\r\n        return true;\r\n    } catch (rejRes) {\r\n        return false;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\prisma\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\makhu\\OneDrive\\Vukosi\\URBANSMART\\Payment Switch\\frontend\\types\\yoco.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]